# 增强三维重建系统UI使用说明

## 🎯 概述

增强三维重建系统提供了图形用户界面：

- **`enhanced_3d_reconstruction_ui_simple.py`** - 基于tkinter的稳定版本（**强烈推荐**）

> **注意**: PySide6版本由于依赖库兼容性问题暂时不可用，建议使用tkinter版本。

## 🚀 快速开始

### 启动UI界面

```bash
# 启动UI界面
python enhanced_3d_reconstruction_ui_simple.py
```

### 系统要求

- Python 3.7+
- tkinter（Python标准库，通常已预装）
- numpy
- 增强三维重建模块
- Open3D（可选，用于3D可视化）

## 📋 界面功能说明

### 🔧 左侧参数面板

#### **输入文件区域**

1. **相机内参文件** - 选择包含相机内参矩阵的标定文件
   - 支持格式：`.json`, `.npy`
   - 内容：相机内参矩阵 (3x3)

2. **投影仪内参文件** - 选择包含投影仪内参矩阵和分辨率的标定文件
   - 支持格式：`.json`, `.npy`
   - 内容：投影仪内参矩阵 (3x3) + 分辨率信息

3. **外参文件** - 选择包含相机和投影仪之间变换关系的外参文件
   - 支持格式：`.json`, `.npy`
   - 内容：旋转矩阵R (3x3) + 平移向量T (3x1)

4. **X方向解包裹相位图** - 选择X方向（水平）解包裹相位图文件
   - 支持格式：`.npy`, `.png`, `.jpg`, `.jpeg`, `.bmp`, `.tiff`, `.tif`

5. **Y方向解包裹相位图** - 选择Y方向（垂直）解包裹相位图文件
   - 支持格式：`.npy`, `.png`, `.jpg`, `.jpeg`, `.bmp`, `.tiff`, `.tif`

6. **输出目录** - 指定重建结果的保存目录

#### **重建参数区域**

1. **使用粒子群优化** - 启用PSO算法提高重建精度
   - ✅ 启用：高精度，速度较慢
   - ❌ 禁用：使用向量化三角测量，速度快

2. **采样步长** - 像素采样间隔
   - 范围：1-20
   - 推荐值：3-5（高精度），6-8（平衡），10+（快速）

3. **掩码阈值百分位数** - 有效区域掩码生成阈值
   - 范围：80.0-99.9
   - 推荐值：88.0-92.0

4. **创建三角网格** - 从点云生成三角网格模型
   - ✅ 启用：生成网格文件
   - ❌ 禁用：仅生成点云

#### **控制区域**

1. **开始三维重建** - 启动重建过程
2. **进度条** - 显示重建进度
3. **状态信息** - 显示当前状态

### 📊 右侧结果面板

#### **结果信息标签页**

- **重建统计** - 显示点云数量、保留率、质量评分等
- **输出文件** - 列出生成的文件路径
- **质量分析** - 显示深度范围、质量分布等

#### **3D可视化按钮**

1. **查看点云** - 使用Open3D显示三维点云
2. **查看网格** - 使用Open3D显示三角网格
3. **打开输出目录** - 在文件管理器中打开结果目录

## 📁 输入文件格式要求

### **相机参数文件格式**

**JSON格式示例：**

```json
{
    "camera_matrix": [
        [fx, 0, cx],
        [0, fy, cy],
        [0, 0, 1]
    ]
}
```

**NumPy格式：**

```python
import numpy as np
camera_matrix = np.array([[fx, 0, cx], [0, fy, cy], [0, 0, 1]])
np.save("camera_params.npy", camera_matrix)
```

### **投影仪参数文件格式**

**JSON格式示例：**

```json
{
    "projector_matrix": [
        [fx, 0, cx],
        [0, fy, cy],
        [0, 0, 1]
    ],
    "projector_width": 1280,
    "projector_height": 800
}
```

### **外参文件格式**

**JSON格式示例：**

```json
{
    "R": [
        [r11, r12, r13],
        [r21, r22, r23],
        [r31, r32, r33]
    ],
    "T": [tx, ty, tz]
}
```

### **相位图文件**

- **NumPy格式**：直接保存的相位数组（推荐）
- **图像格式**：相位值映射到0-255的灰度图像

## 🎮 使用流程

### **步骤1：准备输入文件**

1. 确保所有标定文件格式正确
2. 确保相位图已经过解包裹处理
3. 检查文件路径和权限

### **步骤2：设置参数**

1. 选择所有必需的输入文件
2. 设置输出目录
3. 根据需求调整重建参数

### **步骤3：执行重建**

1. 点击"开始三维重建"按钮
2. 观察进度条和状态信息
3. 等待重建完成

### **步骤4：查看结果**

1. 查看结果信息标签页的统计数据
2. 使用3D可视化按钮查看点云和网格
3. 在输出目录中查看保存的文件

## 📊 输出文件说明

重建完成后，输出目录将包含以下文件：

| 文件名 | 描述 | 格式 |
|--------|------|------|
| `enhanced_pointcloud.ply` | 三维点云文件 | PLY |
| `enhanced_mesh.ply` | 三角网格文件（可选） | PLY |
| `unwrapped_phases.png` | 相位图可视化 | PNG |
| `mask.png` | 有效区域掩码 | PNG |
| `reconstruction_stats.json` | 重建统计信息 | JSON |

## ⚙️ 参数调优建议

### **高精度重建**

- 使用粒子群优化：✅
- 采样步长：3-4
- 掩码阈值：90-92%
- 适用场景：科研、精密测量

### **平衡模式**

- 使用粒子群优化：✅
- 采样步长：5-6
- 掩码阈值：88-90%
- 适用场景：一般应用

### **快速重建**

- 使用粒子群优化：❌
- 采样步长：8-10
- 掩码阈值：85-88%
- 适用场景：快速预览、实时应用

## 🔧 故障排除

### **常见问题**

#### **1. UI无法启动**

- **问题**：缺少依赖库
- **解决**：安装必要的库

```bash
pip install tkinter numpy matplotlib
# 对于现代化UI还需要：
pip install PySide6
```

#### **2. 重建失败**

- **问题**：输入文件格式错误或路径不存在
- **解决**：检查文件格式和路径，确保文件可读

#### **3. 3D可视化无法显示**

- **问题**：Open3D未安装
- **解决**：安装Open3D库

```bash
pip install open3d
```

#### **4. 重建结果点数过少**

- **问题**：参数设置过于严格
- **解决**：
  - 降低掩码阈值百分位数
  - 减小采样步长
  - 检查相位图质量

#### **5. 重建速度过慢**

- **问题**：参数设置过于精细
- **解决**：
  - 禁用粒子群优化
  - 增大采样步长
  - 使用较大的掩码阈值

## 💡 使用技巧

1. **首次使用**：建议先用默认参数进行测试
2. **参数调优**：根据重建结果逐步调整参数
3. **文件管理**：为不同项目创建独立的输出目录
4. **结果验证**：使用3D可视化功能检查重建质量
5. **性能优化**：根据硬件性能调整采样步长

## 📞 技术支持

如遇到问题，请检查：

1. 输入文件格式是否正确
2. 依赖库是否完整安装
3. 系统权限是否足够
4. 硬件资源是否充足

---

**祝您使用愉快！** 🎉
