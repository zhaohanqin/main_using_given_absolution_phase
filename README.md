# 基于结构光的三维成像系统

本项目实现了一个基于结构光的三维成像系统，通过投影结构光条纹并使用双目视觉原理进行三维点云重建。该系统使用了三频外差法进行相位解包裹，并采用粒子群优化算法优化深度估计，提高重建精度。

## 系统原理

结构光三维成像系统通常由投影仪和相机组成。投影仪将结构化光栅投射到待测物体表面，相机捕获物体上的变形光栅图案，通过分析这些变形，可以计算出物体表面的三维形状信息。

### 主要流程

1. **相移条纹投影**：使用不同相位偏移的正弦光栅图案投射到物体表面
2. **多频外差相位解包裹**：使用三种不同频率的条纹进行渐进式相位解包裹
3. **双目几何重建**：通过标定的相机参数和相位信息计算三维点云坐标
4. **深度优化**：使用粒子群优化算法优化深度估计

## 文件结构与功能说明

### 1. `get_abs_phase.py`

包含多频外差法相位解包裹的实现，主要实现了从包裹相位到绝对相位的转换。

主要功能：

- 使用N步相移算法解码相位图，获取包裹相位
- 实现三频外差相位解包裹算法
- 通过高-中-低频率的逐级解包裹，获取绝对相位

三频外差法解包裹原理：

1. 分别计算高频、中频和低频的包裹相位图
2. 计算相位差：高频-中频、中频-低频
3. 通过差值的差值得到等效最低频相位
4. 自底向上展开相位，先用等效最低频相位展开中等频率相位差
5. 再用展开后的中等频率相位差展开中频相位
6. 通过多路径展开结果平均化，提高解包裹的鲁棒性

### 2. `ga.py`

实现了粒子群优化算法，用于优化三维重建中的深度估计。

主要功能：

- 使用粒子群优化算法在给定深度范围内搜索最优深度值
- 通过最小化投影误差函数优化深度估计
- 结合反射模型和B样条插值提高精度

### 3. `get_3d_result.py`

负责将相位图转换为三维点云的实现。

主要功能：

- 将相位图映射到物理坐标系
- 计算两个相机的共视区域
- 在共视区域内使用粒子群算法逐点优化深度
- 生成三维点云数据和法线信息

### 4. `main.py`

主程序，协调各个模块的工作流程。

主要功能：

- 读取标定参数和相位图
- 调用相位解包裹和三维重建模块
- 保存和可视化三维点云结果

### 5. `read_calib.py`

读取相机标定参数的辅助模块。

主要功能：

- 从XML文件中读取立体视觉系统的标定参数
- 包括相机内参、畸变系数和相机/投影仪之间的转换关系

### 6. `read_image.py`

读取图像文件的辅助模块。

主要功能：

- 按照数字顺序读取指定文件夹下的所有图像
- 将图像转换为灰度格式，以便后续处理

## 相位解包裹过程详解

相位解包裹是结构光三维成像中的关键步骤，本系统采用三频外差法进行相位解包裹。

### 外差法原理

外差法利用不同频率条纹的相位信息，通过计算相位差来展开相位。具体步骤如下：

1. 使用N步相移算法（如4步相移）获取各个频率的包裹相位
2. 计算高频与中频、中频与低频的相位差
3. 再计算两个相位差之间的差值，获得等效最低频相位
4. 使用等效最低频相位作为参考，展开高频相位

### 三频外差法优势

1. 抗噪性能强：通过多频率相结合，减少噪声影响
2. 相位跳变处理能力强：可以有效处理阴影和遮挡区域
3. 重建精度高：高频条纹提供细节，低频条纹保证展开正确性

## 投影仪标定过程

投影仪标定是系统准确性的关键，本系统通过以下步骤进行标定：

1. 先进行相机标定，获取相机内参矩阵和畸变系数
2. 将投影仪视为逆向相机，使用已标定的相机和标定板进行联合标定
3. 获取投影仪与相机之间的旋转矩阵和平移向量
4. 计算投影平面参数，用于后续三维重建

## 使用方法

1. 准备好相移图像和标定文件
2. 修改`main.py`中的路径参数指向正确的数据位置
3. 运行`main.py`进行三维重建
4. 结果将保存为点云文件，并显示3D可视化结果

## 依赖库

- OpenCV
- NumPy
- Matplotlib
- PIL (Python Imaging Library)

## 系统限制与未来改进

- 当前系统对于高反光表面和深色物体的重建效果不佳
- 点云稀疏，可通过减小采样步长提高密度（但会增加计算时间）
- 未来可考虑加入颜色信息，实现彩色点云重建
- 可进一步优化粒子群算法的参数，提高计算效率和精度
